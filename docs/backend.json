{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a food item available in the restaurant's menu.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "category": {
          "type": "string",
          "description": "Category of the product (e.g., burger, drink, side)."
        },
        "inventory": {
          "type": "number",
          "description": "The amount of the product currently in stock."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "imageUrl",
        "category",
        "inventory"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date and time when the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used for the order (e.g., credit card, cash)."
        },
        "deliveryAddress": {
          "type": "string",
          "description": "Delivery address for the order."
        },
        "status": {
          "type": "string",
          "description": "Current status of the order (e.g., pending, processing, delivered)."
        },
        "driverId": {
          "type": "string",
          "description": "Reference to Driver. (Relationship: Driver 1:N Order)"
        }
      },
      "required": [
        "id",
        "customerId",
        "orderDate",
        "totalAmount",
        "paymentMethod",
        "deliveryAddress",
        "status"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "itemPrice": {
          "type": "number",
          "description": "Price of the individual item at the time of order."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "itemPrice"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer of the restaurant.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the customer."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the customer."
        },
        "email": {
          "type": "string",
          "description": "Email address of the customer.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "Phone number of the customer."
        },
        "deliveryAddresses": {
          "type": "array",
          "description": "Delivery addresses associated with the customer.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phoneNumber"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user profile stored in Firestore.",
      "properties": {
        "uid": { "type": "string", "description": "The user's unique ID." },
        "displayName": { "type": "string", "description": "The user's display name." },
        "email": { "type": "string", "description": "The user's email address." },
        "photoURL": { "type": "string", "description": "URL for the user's profile picture." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the user profile was created." }
      },
      "required": ["uid", "email"]
    },
    "Driver": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Driver",
      "type": "object",
      "description": "Represents a delivery driver.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the driver."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the driver."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the driver."
        },
        "phoneNumber": {
          "type": "string",
          "description": "Phone number of the driver."
        },
        "available": {
          "type": "boolean",
          "description": "Indicates if the driver is currently available for deliveries."
        },
        "currentLocation": {
          "type": "string",
          "description": "Current location coordinates of the driver."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "phoneNumber",
        "available"
      ]
    },
    "SuggestedProduct": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SuggestedProduct",
      "type": "object",
      "description": "Represents a product suggested to a customer, based on the items in their cart.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the suggested product."
        },
        "productId": {
          "type": "string",
          "description": "Reference to the Product being suggested. (Relationship: Product 1:N SuggestedProduct)"
        },
        "orderId": {
          "type": "string",
          "description": "Reference to the Order for which the product is suggested. (Relationship: Order 1:N SuggestedProduct)"
        },
        "suggestionReason": {
          "type": "string",
          "description": "The AI derived reason for suggesting this product."
        },
        "suggestionScore": {
          "type": "number",
          "description": "AI derived relevancy score of the suggestion."
        }
      },
      "required": [
        "id",
        "productId",
        "orderId",
        "suggestionReason",
        "suggestionScore"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores information about each product offered by the restaurant.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
            "entityName": "User",
            "schema": { "$ref": "#/backend/entities/User" },
            "description": "Stores public user profile information for all users.",
            "params": [{ "name": "userId", "description": "Unique identifier for the user." }]
        }
      },
      {
        "path": "/users/{userId}/customer_profile",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer profile information. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user (customer)."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order information. Includes denormalized 'customerId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user (customer)."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/order_items/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores individual items within an order.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user (customer)."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "Unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/suggested_products/{suggestedProductId}",
        "definition": {
          "entityName": "SuggestedProduct",
          "schema": {
            "$ref": "#/backend/entities/SuggestedProduct"
          },
          "description": "Stores AI derived suggestions for products related to the users cart.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user (customer)."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            },
            {
              "name": "suggestedProductId",
              "description": "Unique identifier for the suggested product."
            }
          ]
        }
      },
      {
        "path": "/drivers/{driverId}",
        "definition": {
          "entityName": "Driver",
          "schema": {
            "$ref": "#/backend/entities/Driver"
          },
          "description": "Stores driver information.",
          "params": [
            {
              "name": "driverId",
              "description": "Unique identifier for the driver."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection used to grant admin privileges. Document existence determines admin role."
        }
      },
      {
        "path": "/roles_driver/{userId}",
        "definition": {
          "schema": {
            "$ref": "#/backend/entities/Driver"
          },
          "description": "Collection used to grant driver privileges. Document existence determines driver role."
        }
      }
    ],
    "reasoning": "This Firestore structure is designed for the FastFoodGo application, prioritizing security, scalability, and ease of debugging, following the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. It incorporates denormalization for authorization and structural segregation to streamline security rules.\n\n*   **Products:** The `products` collection stores the restaurant's menu items. This collection has a flat structure and uniform access control needs (admin only), so structural segregation is not needed.\n*   **Customers & Orders:** Customer data is stored under `/users/{userId}/customer_profile`. Orders, OrderItems and SuggestedProducts are nested under the customer. This structure allows for path-based ownership for the customer's data. The denormalization occurs with the order objects, which contain the customerId. This allows for listing orders not dependent on the user.\n*   **Drivers & Orders:** Driver data is stored in the `/drivers/{driverId}` collection. Similar to Customers, Orders are also nested under drivers with the driverId as a denormalized field on the Order object. This pattern enables simple read/write rules for drivers to only access orders assigned to them. Orders are assigned to drivers by writing the driverId to the Order document.\n*   **Admin & Driver Roles:** The `/roles_admin/{uid}` and `/roles_driver/{uid}` collections grant privileges based on document existence (DBAC).\n\n**Authorization Independence (Denormalization):**\n*   The key denormalization strategy involves including the `customerId` and `driverId` within the `Order` documents. This allows for rules that validate that the `customerId` matches the `request.auth.uid` when creating an order or for the driver to validate that the `driverId` matches their `uid`. Rules do NOT need to perform `get()` operations to validate a parent object, enabling atomic operations and enhanced security.\n\n**QAPs (Rules are not Filters):**\n*   Structural segregation is used to separate concerns. Customer data is stored under the user, Driver data under the Driver Id. This segregation means rules do not act as filters. List operations do not need to filter based on user role, as the path structure itself enforces this separation."
  }
}
